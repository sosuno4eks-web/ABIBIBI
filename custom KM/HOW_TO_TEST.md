# –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥—Ä–∞–π–≤–µ—Ä —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

## ‚úÖ –ß—Ç–æ –º—ã —É–∂–µ –∑–Ω–∞–µ–º –∏–∑ –ª–æ–≥–∞:

```
[+] Image base has been allocated at 0xFFFFA48E3B9DD000  ‚Üê –î—Ä–∞–π–≤–µ—Ä –≤ –ø–∞–º—è—Ç–∏ —è–¥—Ä–∞
[<] Calling DriverEntry 0xFFFFA48E3B9DE000              ‚Üê DriverEntry –≤—ã–∑–≤–∞–Ω
[+] DriverEntry returned 0x0                            ‚Üê –í–µ—Ä–Ω—É–ª SUCCESS
[+] success                                             ‚Üê –í—Å–µ —É—Å–ø–µ—à–Ω–æ
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –¥—Ä–∞–π–≤–µ—Ä **–†–ï–ê–õ–¨–ù–û** –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∏ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è!

## üîç –°–ø–æ—Å–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:

### –°–ø–æ—Å–æ–± 1: DebugView (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–°–∫–∞—á–∞–π DebugView:**
   https://learn.microsoft.com/sysinternals/downloads/debugview

2. **–ó–∞–ø—É—Å—Ç–∏ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
   ```
   Dbgview.exe (–ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π -> Run as administrator)
   ```

3. **–í–∫–ª—é—á–∏ Kernel Capture:**
   - –ú–µ–Ω—é: Capture -> Capture Kernel (Ctrl+K)
   - –ú–µ–Ω—é: Capture -> Enable Verbose Kernel Output

4. **–ó–∞–ø—É—Å—Ç–∏ –º–∞–ø–ø–µ—Ä:**
   ```cmd
   cd x64\Release
   rtkaudio.exe --copy-header --free ..\..\HelloWorld.sys
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥:**
   –¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å: `Hello world!`

---

### –°–ø–æ—Å–æ–± 2: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –¥—Ä–∞–π–≤–µ—Ä —Å —Ñ–∞–π–ª–æ–º

–Ø —Å–æ–∑–¥–∞–ª `TestDriver.cpp` –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `C:\test_driver_loaded.txt`

**–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

1. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π TestDriver.cpp –≤ .sys —Ñ–∞–π–ª
2. –ó–∞–ø—É—Å—Ç–∏:
   ```cmd
   rtkaudio.exe --copy-header --free TestDriver.sys
   ```
3. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª:
   ```cmd
   type C:\test_driver_loaded.txt
   ```
   
–ï—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –¥—Ä–∞–π–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

### –°–ø–æ—Å–æ–± 3: WinDbg (–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)

1. **–£—Å—Ç–∞–Ω–æ–≤–∏ WinDbg:**
   https://learn.microsoft.com/windows-hardware/drivers/debugger/

2. **–í–∫–ª—é—á–∏ kernel debugging:**
   ```cmd
   bcdedit /debug on
   bcdedit /dbgsettings local
   ```

3. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Å—å**

4. **–ó–∞–ø—É—Å—Ç–∏ WinDbg –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
   - File -> Kernel Debug -> Local
   - Break (Ctrl+Break)

5. **–ó–∞–ø—É—Å—Ç–∏ –º–∞–ø–ø–µ—Ä –≤ –¥—Ä—É–≥–æ–º –æ–∫–Ω–µ**

6. **–í WinDbg —Å–º–æ—Ç—Ä–∏ –≤—ã–≤–æ–¥:**
   ```
   kd> g
   ```
   –¢—ã —É–≤–∏–¥–∏—à—å "Hello world!"

---

### –°–ø–æ—Å–æ–± 4: Process Monitor (–ü—Ä–æ—Å—Ç–æ–π)

1. **–°–∫–∞—á–∞–π Process Monitor:**
   https://learn.microsoft.com/sysinternals/downloads/procmon

2. **–ó–∞–ø—É—Å—Ç–∏ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

3. **–ù–∞—Å—Ç—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä:**
   - Filter -> Filter...
   - Process Name -> is -> rtkaudio.exe -> Include
   - Add

4. **–ó–∞–ø—É—Å—Ç–∏ –º–∞–ø–ø–µ—Ä:**
   ```cmd
   rtkaudio.exe --copy-header --free HelloWorld.sys
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å –≤ Process Monitor:**
   - –¢—ã —É–≤–∏–¥–∏—à—å –∑–∞–≥—Ä—É–∑–∫—É –¥—Ä–∞–π–≤–µ—Ä–∞ –≤ %temp%
   - –¢—ã —É–≤–∏–¥–∏—à—å –≤—ã–∑–æ–≤—ã NtLoadDriver
   - –¢—ã —É–≤–∏–¥–∏—à—å —Å–æ–∑–¥–∞–Ω–∏–µ Device

---

### –°–ø–æ—Å–æ–± 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–≤–æ–µ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞

–ï—Å–ª–∏ —Ç–≤–æ–π –¥—Ä–∞–π–≤–µ—Ä –¥–µ–ª–∞–µ—Ç —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç –ø–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞), –ø—Ä–æ–≤–µ—Ä—å —ç—Ç–æ:

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –¥—Ä–∞–π–≤–µ—Ä–∞ —á—Ç–µ–Ω–∏—è –ø–∞–º—è—Ç–∏:**

1. –ó–∞–ø—É—Å—Ç–∏ —Ü–µ–ª–µ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, notepad.exe)
2. –ó–∞–ø—É—Å—Ç–∏ –º–∞–ø–ø–µ—Ä —Å —Ç–≤–æ–∏–º –¥—Ä–∞–π–≤–µ—Ä–æ–º
3. –ò—Å–ø–æ–ª—å–∑—É–π usermode –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–≤—è–∑–∏ —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéØ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (30 —Å–µ–∫—É–Ω–¥):

### –í–∞—Ä–∏–∞–Ω—Ç A: DebugView
```
1. –°–∫–∞—á–∞–π –∏ –∑–∞–ø—É—Å—Ç–∏ DebugView –æ—Ç –∞–¥–º–∏–Ω–∞
2. Capture -> Capture Kernel
3. –ó–∞–ø—É—Å—Ç–∏: rtkaudio.exe --copy-header --free HelloWorld.sys
4. –°–º–æ—Ç—Ä–∏ "Hello world!" –≤ –ª–æ–≥–∞—Ö
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥ –º–∞–ø–ø–µ—Ä–∞
```
–ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å:
[+] DriverEntry returned 0x0
[+] success

–ó–Ω–∞—á–∏—Ç –¥—Ä–∞–π–≤–µ—Ä –†–ï–ê–õ–¨–ù–û –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –≤ —è–¥—Ä–µ!
```

---

## ‚ùì –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Å—Ç–∞—Ç—É—Å—ã:

| –°—Ç–∞—Ç—É—Å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| `NtLoadDriver Status 0x0` | –î—Ä–∞–π–≤–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —è–¥—Ä–æ ‚úÖ |
| `Image base allocated` | –ü–∞–º—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∞ –≤ —è–¥—Ä–µ ‚úÖ |
| `Calling DriverEntry` | DriverEntry –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ‚úÖ |
| `DriverEntry returned 0x0` | DriverEntry –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ ‚úÖ |
| `success` | –í—Å–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ ‚úÖ |

–ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å –≤—Å–µ —ç—Ç–∏ —Å—Ç–∞—Ç—É—Å—ã - **–¥—Ä–∞–π–≤–µ—Ä 100% —Ä–∞–±–æ—Ç–∞–µ—Ç!**

---

## üî• –î–ª—è —Ç–≤–æ–µ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞:

–ü–æ—Å–∫–æ–ª—å–∫—É —Ç–≤–æ–π –¥—Ä–∞–π–≤–µ—Ä "ghost" (–±–µ–∑ Device), –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:

1. **–ï—Å–ª–∏ —á–∏—Ç–∞–µ—Ç –ø–∞–º—è—Ç—å:**
   - –ò—Å–ø–æ–ª—å–∑—É–π usermode –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —á—Ç–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. **–ï—Å–ª–∏ —Ö—É–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ö—É–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è

3. **–ï—Å–ª–∏ —Å–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å:**
   - –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –≤–∏–¥–µ–Ω –≤ Task Manager

---

## üí° –°–æ–≤–µ—Ç:

–î–æ–±–∞–≤—å –≤ —Å–≤–æ–π –¥—Ä–∞–π–≤–µ—Ä `DbgPrintEx` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```cpp
NTSTATUS DriverEntry(...)
{
    DbgPrintEx(0, 0, "[MyDriver] Loaded successfully!\n");
    
    // –¢–≤–æ–π –∫–æ–¥...
    
    DbgPrintEx(0, 0, "[MyDriver] Initialization complete!\n");
    return STATUS_SUCCESS;
}
```

–ó–∞—Ç–µ–º —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –≤ DebugView!

---

## ‚úÖ –í—ã–≤–æ–¥:

–ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å –≤ –ª–æ–≥–µ –º–∞–ø–ø–µ—Ä–∞:
```
[+] DriverEntry returned 0x0
[+] success
```

**–î—Ä–∞–π–≤–µ—Ä –†–ï–ê–õ–¨–ù–û —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ

–≠—Ç–æ –Ω–µ —Å–∏–º—É–ª—è—Ü–∏—è - —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ kernel mode!
